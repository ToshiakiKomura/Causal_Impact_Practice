{
    "type": [
        2,
        2,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        3,
        3,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        3,
        3,
        3,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2
    ],
    "data": [
        "\nR version 3.6.3 (2020-02-29) -- \"Holding the Windsock\"\nCopyright (C) 2020 The R Foundation for Statistical Computing\nPlatform: x86_64-apple-darwin15.6.0 (64-bit)\n\nR は、自由なソフトウェアであり、「完全に無保証」です。 \n一定の条件に従えば、自由にこれを再配布することができます。 \n配布条件の詳細に関しては、'license()' あるいは 'licence()' と入力してください。 \n\nR は多くの貢献者による共同プロジェクトです。 \n詳しくは 'contributors()' と入力してください。 \nまた、R や R のパッケージを出版物で引用する際の形式については \n'citation()' と入力してください。 \n\n",
        "'demo()' と入力すればデモをみることができます。 \n'help()' とすればオンラインヘルプが出ます。 \n'help.start()' で HTML ブラウザによるヘルプがみられます。 \n'q()' と入力すれば R を終了します。 \n\n",
        "> ",
        "JS_grp_summary",
        " エラー:  オブジェクト 'JS_grp_summary' がありません \n",
        "> ",
        "# (1) tidyverseとbroomの読み込み",
        "> ",
        "library(\"tidyverse\")",
        "\u001B[30m─ \u001B[1mAttaching packages\u001B[22m ──────────────────────── tidyverse 1.3.0 ─\u001B[39m\n",
        "\u001B[30m\u001B[32m✓\u001B[30m \u001B[34mggplot2\u001B[30m 3.3.2     \u001B[32m✓\u001B[30m \u001B[34mpurrr  \u001B[30m 0.3.3\n\u001B[32m✓\u001B[30m \u001B[34mtibble \u001B[30m 3.0.3     \u001B[32m✓\u001B[30m \u001B[34mdplyr  \u001B[30m 1.0.4\n\u001B[32m✓\u001B[30m \u001B[34mtidyr  \u001B[30m 1.1.2     \u001B[32m✓\u001B[30m \u001B[34mstringr\u001B[30m 1.4.0\n\u001B[32m✓\u001B[30m \u001B[34mreadr  \u001B[30m 1.3.1     \u001B[32m✓\u001B[30m \u001B[34mforcats\u001B[30m 0.5.0\u001B[39m\n",
        "\u001B[30m─ \u001B[1mConflicts\u001B[22m ────────────────────────── tidyverse_conflicts() ─\n\u001B[31mx\u001B[30m \u001B[34mdplyr\u001B[30m::\u001B[32mfilter()\u001B[30m masks \u001B[34mstats\u001B[30m::filter()\n\u001B[31mx\u001B[30m \u001B[34mdplyr\u001B[30m::\u001B[32mlag()\u001B[30m    masks \u001B[34mstats\u001B[30m::lag()\u001B[39m\n",
        "> ",
        "# (1) tidyverseとbroomの読み込み",
        "> ",
        "library(\"tidyverse\")",
        "> ",
        "library(\"broom\")",
        "> ",
        "",
        "> ",
        "# (2) John Snowデータの読み込み",
        "> ",
        "## Data from Table.12 in Snow(1855)",
        "> ",
        "## http://www.ph.ucla.edu/epi/snow/table12a.html",
        "> ",
        "",
        "> ",
        "## 1849年におけるエリア毎のコレラによる死者数",
        "> ",
        "### Southwark and Vauxhall Company",
        "> ",
        "sv1849 <- c(283,157,192,249,259,226,352,97,111,8,235,92)",
        "> ",
        "",
        "> ",
        "### Lambeth Company & Southwark and Vauxhall Company",
        "> ",
        "lsv1849 <- c(256,267,312,257,318,446,143,193,243,215,544,187,153,81,113,176)",
        "> ",
        "",
        "> ",
        "## 1849年におけるエリア毎のコレラによる死者数",
        "> ",
        "### Southwark and Vauxhall Company",
        "> ",
        "sv1854 <- c(371, 161, 148, 362, 244, 237, 282, 59, 171, 9, 240, 174)",
        "> ",
        "",
        "> ",
        "### Lambeth Company & Southwark and Vauxhall Company",
        "> ",
        "lsv1854 <- c(113,174,270,93,210,388,92,58,117,49,193,303,142,48,165,132)",
        "> ",
        "",
        "> ",
        "## コレラの死者数を会社ごとにまとめる",
        "> ",
        "sv_death <- c(sv1849, sv1854)",
        "> ",
        "lsv_death <- c(lsv1849, lsv1854)",
        "> ",
        "",
        "> ",
        "## どのデータがどのエリアのものか",
        "> ",
        "sv_area <- paste0(\"sv_\",c(1:length(sv1849), 1:length(sv1854)))",
        "> ",
        "lsv_area <- paste0(\"lsv_\", c(1:length(lsv1849), 1:length(lsv1854)))",
        "> ",
        "",
        "> ",
        "## どのデータがどの年のものか",
        "> ",
        "sv_year <- c(rep(\"1849\",length(sv1849)), rep(\"1854\", length(sv1854)))",
        "> ",
        "lsv_year <- c(rep(\"1849\",length(lsv1849)), rep(\"1854\", length(lsv1854)))",
        "> ",
        "",
        "> ",
        "## Southwark & Vauxhallのデータフレームを作成",
        "> ",
        "sv <- data.frame(area = sv_area,",
        "+ ",
        "                 year = sv_year,",
        "+ ",
        "                 death = sv_death,",
        "+ ",
        "                 LSV = \"0\",",
        "+ ",
        "                 company = \"Southwark and Vauxhall\")",
        "> ",
        "",
        "> ",
        "## Lambeth & Southwark and Vauxhallのデータフレームを作成",
        "> ",
        "lsv <- data.frame(area = lsv_area,",
        "+ ",
        "                  year = lsv_year,",
        "+ ",
        "                  death = lsv_death,",
        "+ ",
        "                  LSV = \"1\",",
        "+ ",
        "                  company = \"Lambeth & Southwark and Vauxhall\")",
        "> ",
        "",
        "> ",
        "## 地域・年別のデータセットの作成",
        "> ",
        "JS_df <- rbind(sv, lsv) %>%",
        "+ ",
        "  mutate(LSV =",
        "+ ",
        "           if_else(company == \"Lambeth & Southwark and Vauxhall\", 1, 0))",
        "> ",
        "",
        "> ",
        "## 会社別のデータセットを作成",
        "> ",
        "JS_sum <- JS_df %>%",
        "+ ",
        "  group_by(company, LSV, year) %>%",
        "+ ",
        "  summarise(death = sum(death))",
        "`summarise()` has grouped output by 'company', 'LSV'. You can override using the `.groups` argument.\n",
        "> ",
        "",
        "> ",
        "# (3) 集計と可視化による分析",
        "> ",
        "## 集計による推定",
        "> ",
        "JS_grp_summary <- JS_sum %>%",
        "+ ",
        "  mutate(year = paste(\"year\", year, sep = \"_\")) %>%",
        "+ ",
        "  spread(year, death) %>%",
        "+ ",
        "  mutate(gap = year_1854 - year_1849,",
        "+ ",
        "         gap_rate = year_1854/year_1849 - 1)",
        "> ",
        "",
        "> ",
        "## 集計による推定(log)",
        "> ",
        "JS_grp_summary_ln <- JS_sum %>%",
        "+ ",
        "  mutate(year = paste(\"year\", year, sep = \"_\"),",
        "+ ",
        "         death = log(death)) %>%",
        "+ ",
        "  spread(year, death) %>%",
        "+ ",
        "  mutate(gap = year_1854 - year_1849)",
        "> ",
        "",
        "> ",
        "## ggplotによる可視化",
        "> ",
        "did_plot <- JS_sum %>%",
        "+ ",
        "  ggplot(aes(y = death, x = year, shape = company)) +",
        "+ ",
        "  geom_point(size = 2) +",
        "+ ",
        "  geom_line(aes(group = company), linetype = 1) +",
        "+ ",
        "  ylim(2000, 4250) +",
        "+ ",
        "  theme_bw() +",
        "+ ",
        "  theme(plot.title = element_text(hjust = 0.5),",
        "+ ",
        "        legend.position = \"bottom\",",
        "+ ",
        "        plot.margin = margin(1,1,1,1, \"cm\"))",
        "> ",
        "",
        "> ",
        "## ggplotによる可視化(アノテーションを追加)",
        "> ",
        "did_plot +",
        "+ ",
        "  annotate(\"text\", x = 2.2, y = 2400, label = \"(1)\") +",
        "+ ",
        "  annotate(\"text\", x = 2.2, y = 3904 + 197*0.6, label = \"(2)\") +",
        "+ ",
        "  annotate(\"text\", x = 2.2, y = 3300, label = \"(3)\") +",
        "+ ",
        "  annotate(\"segment\", # for common trend in treatment group",
        "+ ",
        "           x = 1, xend = 2,",
        "+ ",
        "           y = 3904, yend = 3904 + 197,",
        "+ ",
        "           arrow = arrow(length = unit(.2,\"cm\")),",
        "+ ",
        "           size = 0.1,",
        "+ ",
        "           linetype = 2) +",
        "+ ",
        "  annotate(\"segment\", # for parallel trend",
        "+ ",
        "           x = 1, xend = 2,",
        "+ ",
        "           y = 2261, yend = 2261,",
        "+ ",
        "           size = 0.1,",
        "+ ",
        "           linetype = 2) +",
        "+ ",
        "  annotate(\"segment\", # for parallel trend",
        "+ ",
        "           x = 1, xend = 2,",
        "+ ",
        "           y = 3904, yend = 3904,",
        "+ ",
        "           size = 0.1,",
        "+ ",
        "           linetype = 2) +",
        "+ ",
        "  annotate(\"segment\", # for (1)",
        "+ ",
        "           x = 2.07, xend = 2.07,",
        "+ ",
        "           y = 2261, yend = 2458,",
        "+ ",
        "           arrow = arrow(ends = \"both\",",
        "+ ",
        "                         length = unit(.1,\"cm\"),angle = 90)) +",
        "+ ",
        "  annotate(\"segment\", # for (2)",
        "+ ",
        "           x = 2.07, xend = 2.07,",
        "+ ",
        "           y = 3904, yend = 3904 + 197,",
        "+ ",
        "           arrow = arrow(ends = \"both\",",
        "+ ",
        "                         length = unit(.1,\"cm\"),angle = 90)) +",
        "+ ",
        "  annotate(\"segment\", # for (3)",
        "+ ",
        "           x = 2.07, xend = 2.07,",
        "+ ",
        "           y = 3904, yend = 2547,",
        "+ ",
        "           arrow = arrow(ends = \"both\",",
        "+ ",
        "                         length = unit(.1,\"cm\"),angle = 90))",
        "> ",
        "",
        "> ",
        "# (4) 回帰分析を用いたDID",
        "> ",
        "## Difference in Difference",
        "> ",
        "JS_did <- JS_sum %>%",
        "+ ",
        "  mutate(D1854 = if_else(year == 1854, 1, 0)) %>%",
        "+ ",
        "  lm(data = ., death ~ LSV + D1854 + D1854:LSV) %>%",
        "+ ",
        "  tidy()",
        "> ",
        "",
        "> ",
        "## Difference in Difference(log)",
        "> ",
        "JS_did_log <- JS_sum %>%",
        "+ ",
        "  mutate(D1854 = if_else(year == 1854, 1, 0)) %>%",
        "+ ",
        "  lm(data = ., log(death) ~ LSV + D1854 + D1854:LSV) %>%",
        "+ ",
        "  tidy()",
        "> ",
        "",
        "> ",
        "## Difference in Difference(エリア単位)",
        "> ",
        "JS_did_area <- JS_df %>%",
        "+ ",
        "  mutate(D1854 = if_else(year == 1854, 1, 0)) %>%",
        "+ ",
        "  lm(data = ., death ~ LSV + area + D1854 + D1854:LSV) %>%",
        "+ ",
        "  tidy() %>%",
        "+ ",
        "  filter(!str_detect(term, \"area\"))",
        "> ",
        "",
        "> ",
        "## Difference in Difference(州単位、log)",
        "> ",
        "JS_did_area_log <- JS_df %>%",
        "+ ",
        "  mutate(D1854 = if_else(year == 1854, 1, 0)) %>%",
        "+ ",
        "  lm(data = ., log(death) ~ LSV + area + D1854 + D1854:LSV) %>%",
        "+ ",
        "  tidy() %>%",
        "+ ",
        "  filter(!str_detect(term, \"area\"))",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "# (5) 分析するデータのあるパッケージをインストール(初回のみ)",
        "> ",
        "install.packages(\"Ecdat\")",
        " URL 'https://cran.rstudio.com/bin/macosx/el-capitan/contrib/3.6/Ecdat_0.3-9.tgz' を試しています \n",
        "Content type 'application/x-gzip'",
        " length 3993599 bytes (3.8 MB)\n",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "=",
        "\n",
        "downloaded 3.8 MB\n\n",
        "\nThe downloaded binary packages are in\n\t/var/folders/2f/wpvrdpxs4fq1xbvznmcbz4qr0000gn/T//RtmpYdhBb6/downloaded_packages\n",
        "> ",
        "",
        "> ",
        "# (6) ライブラリの読み込み",
        "> ",
        "library(\"Ecdat\")",
        " 要求されたパッケージ Ecfun をロード中です \n",
        "\n 次のパッケージを付け加えます: ‘Ecfun’ \n\n",
        " 以下のオブジェクトは ‘package:base’ からマスクされています: \n\n     sign \n\n",
        "\n 次のパッケージを付け加えます: ‘Ecdat’ \n\n",
        " 以下のオブジェクトは ‘package:datasets’ からマスクされています: \n\n     Orange \n\n",
        "> ",
        "",
        "> ",
        "# (7) Proposition99の分析：集計による分析",
        "> ",
        "## データの準備",
        "> ",
        "",
        "> ",
        "### Common Trend Assumptionの為に分析から特定の州を外す",
        "> ",
        "### タバコの税金が1988年以降50セント以上上がった州のリスト",
        "> ",
        "### Alaska, Hawaii, Maryland, Michigan, New Jersey, New York, Washington",
        "> ",
        "skip_state <- c(3,9,10,22,21,23,31,33,48)",
        "> ",
        "",
        "> ",
        "### Cigarデータセットの読み込み",
        "> ",
        "### skip_stateに含まれる州のデータを削除",
        "> ",
        "Cigar <- Cigar %>%",
        "+ ",
        "  filter(!state %in% skip_state,",
        "+ ",
        "         year >= 70) %>%",
        "+ ",
        "  mutate(area = if_else(state == 5, \"CA\", \"Rest of US\"))",
        "> ",
        "",
        "> ",
        "## 前後比較による分析",
        "> ",
        "Cigar %>%",
        "+ ",
        "  mutate(period = if_else(year > 87, \"after\", \"before\"),",
        "+ ",
        "         state = if_else(state == 5, \"CA\", \"Rest of US\")) %>%",
        "+ ",
        "  group_by(period, state) %>%",
        "+ ",
        "  summarise(sales = sum(sales*pop16)/sum(pop16)) %>%",
        "+ ",
        "  spread(state, sales)",
        "`summarise()` has grouped output by 'period'. You can override using the `.groups` argument.\n\u001B[38;5;246m# A tibble: 2 x 3\u001B[39m\n\u001B[38;5;246m# Groups:   period [2]\u001B[39m\n  period    CA `Rest of US`\n  \u001B[3m\u001B[38;5;246m<chr>\u001B[39m\u001B[23m  \u001B[3m\u001B[38;5;246m<dbl>\u001B[39m\u001B[23m        \u001B[3m\u001B[38;5;246m<dbl>\u001B[39m\u001B[23m\n\u001B[38;5;250m1\u001B[39m after   77.1         107.\n\u001B[38;5;250m2\u001B[39m before 117.          127.\n",
        "> ",
        "",
        "> ",
        "## 前後比較のプロット",
        "> ",
        "Cigar %>%",
        "+ ",
        "  mutate(period = if_else(year > 87, \"after\", \"before\"),",
        "+ ",
        "         state = if_else(state == 5, \"CA\", \"Rest of US\")) %>%",
        "+ ",
        "  group_by(period, state) %>%",
        "+ ",
        "  summarise(sales = sum(sales*pop16)/sum(pop16)) %>%",
        "+ ",
        "  ggplot(aes(y = sales,",
        "+ ",
        "             x = period,",
        "+ ",
        "             shape = state,",
        "+ ",
        "             linetype = state)) +",
        "+ ",
        "  geom_point(size = 2) +",
        "+ ",
        "  geom_line(aes(group = state)) +",
        "+ ",
        "  ylim(0, NA) +",
        "+ ",
        "  theme_bw() +",
        "+ ",
        "  theme(plot.title = element_text(hjust = 0.5),",
        "+ ",
        "        legend.position = \"bottom\",",
        "+ ",
        "        plot.margin = margin(1,1,1,1, \"cm\")) +",
        "+ ",
        "  scale_x_discrete(name =\"Period\",limits=c(\"before\",\"after\"))",
        "`summarise()` has grouped output by 'period'. You can override using the `.groups` argument.\n",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "## タバコの売上のトレンドを示すプロット",
        "> ",
        "Cigar %>%",
        "+ ",
        "  mutate(state = if_else(state == 5, \"CA\", \"Rest of US\")) %>%",
        "+ ",
        "  group_by(year,state) %>%",
        "+ ",
        "  summarise(sales = sum(sales*pop16)/sum(pop16)) %>%",
        "+ ",
        "  ggplot(aes(y = sales,",
        "+ ",
        "             x = year,",
        "+ ",
        "             shape = state,",
        "+ ",
        "             linetype = state)) +",
        "+ ",
        "  geom_line() +",
        "+ ",
        "  geom_point(size = 2) +",
        "+ ",
        "  geom_vline(xintercept = 88, linetype = 4) +",
        "+ ",
        "  theme_bw() +",
        "+ ",
        "  theme(plot.title = element_text(hjust = 0.5),",
        "+ ",
        "        legend.position = \"bottom\",",
        "+ ",
        "        plot.margin = margin(1,1,1,1, \"cm\"))",
        "`summarise()` has grouped output by 'year'. You can override using the `.groups` argument.\n",
        "> ",
        "",
        "> ",
        "# (8) DIDのためのデータを準備",
        "> ",
        "## カリフォルニア州とその他という2グループのデータ",
        "> ",
        "Cigar_did_sum <- Cigar %>%",
        "+ ",
        "  mutate(post = if_else(year > 87, 1, 0),",
        "+ ",
        "         ca = if_else(state == 5, 1, 0),",
        "+ ",
        "         state = factor(state),",
        "+ ",
        "         year_dummy = paste(\"D\", year, sep = \"_\")) %>%",
        "+ ",
        "  group_by(post, year, year_dummy, ca) %>%",
        "+ ",
        "  summarise(sales = sum(sales*pop16)/sum(pop16))",
        "`summarise()` has grouped output by 'post', 'year', 'year_dummy'. You can override using the `.groups` argument.\n",
        "> ",
        "",
        "> ",
        "## カリフォルニア州とその他の州という州ごとでのデータ",
        "> ",
        "Cigar_did_data <- Cigar %>%",
        "+ ",
        "  mutate(post = if_else(year > 87, 1, 0),",
        "+ ",
        "         ca = if_else(state == 5, 1, 0),",
        "+ ",
        "         state = factor(state),",
        "+ ",
        "         year_dummy = paste(\"D\", year, sep = \"_\")) %>%",
        "+ ",
        "  group_by(post, ca, year, year_dummy, state) %>%",
        "+ ",
        "  summarise(sales = sum(sales*pop16)/sum(pop16))",
        "`summarise()` has grouped output by 'post', 'ca', 'year', 'year_dummy'. You can override using the `.groups` argument.\n",
        "> ",
        "",
        "> ",
        "# (9) カリフォルニア州とその他というグループでの分析",
        "> ",
        "## 2グループでのデータでの分析",
        "> ",
        "Cigar_did_sum_reg <- Cigar_did_sum %>%",
        "+ ",
        "  lm(data = ., sales ~ ca + post + ca:post + year_dummy) %>%",
        "+ ",
        "  tidy() %>%",
        "+ ",
        "  filter(!str_detect(term, \"state\"),",
        "+ ",
        "         !str_detect(term, \"year\"))",
        "> ",
        "",
        "> ",
        "## 2グループでのデータでの分析(log)",
        "> ",
        "Cigar_did_sum_logreg <- Cigar_did_sum %>%",
        "+ ",
        "  lm(data = ., log(sales) ~ ca + post + ca:post + year_dummy) %>%",
        "+ ",
        "  tidy() %>%",
        "+ ",
        "  filter(!str_detect(term, \"state\"),",
        "+ ",
        "         !str_detect(term, \"year\"))",
        "> ",
        "",
        "> ",
        "# (10) 州ごとのデータでの分析",
        "> ",
        "## miceaddsのインストール",
        "> ",
        "install.packages(\"miceadds\")",
        "Error in install.packages : Updating loaded packages\n",
        "> ",
        "",
        "> ",
        "## 州ごとのデータでの分析",
        "> ",
        "Cigar_did_data_cluster <- Cigar_did_data %>%",
        "+ ",
        "  miceadds::lm.cluster(data = .,",
        "+ ",
        "                       sales ~ ca + state + post + ca:post + year_dummy,",
        "+ ",
        "                       cluster = \"state\") %>%",
        "+ ",
        "  summary()",
        "Loading required namespace: sandwich\n",
        "R^2= 0.89867 \n\n                    Estimate   Std. Error       t value     Pr(>|t|)\n(Intercept)    105.525726632 2.271808e+00  4.645010e+01 0.000000e+00\nca               1.126375470 5.991903e-01  1.879829e+00 6.013134e-02\nstate4           7.782608696 9.370881e-14  8.305098e+13 0.000000e+00\nstate7          -2.121739130 9.525860e-14 -2.227347e+13 0.000000e+00\nstate8          34.147826087 1.015714e-13  3.361951e+14 0.000000e+00\nstate11         11.782608696 7.220863e-14  1.631745e+14 0.000000e+00\nstate13       ",
        "  -4.191304348 7.305190e-14 -5.737433e+13 0.000000e+00\nstate14         10.291304348 7.399301e-14  1.390848e+14 0.000000e+00\nstate15         32.843478261 7.313753e-14  4.490646e+14 0.000000e+00\nstate16          0.260869565 7.487857e-14  3.483901e+12 0.000000e+00\nstate17          3.191304348 8.264866e-14  3.861290e+13 0.000000e+00\nstate18         82.121739130 8.096093e-14  1.014338e+15 0.000000e+00\nstate19         14.617391304 7.256790e-14  2.014306e+14 0.000000e+00\nstate20         21.039130435 7.216654e-14  2.915358e+14",
        " 0.000000e+00\nstate24         -4.065217391 8.693906e-14 -4.675939e+13 0.000000e+00\nstate25          3.017391304 7.369147e-14  4.094628e+13 0.000000e+00\nstate26         20.121739130 7.281235e-14  2.763506e+14 0.000000e+00\nstate27         -1.839130435 7.547261e-14 -2.436818e+13 0.000000e+00\nstate28         -4.608695652 9.233625e-14 -4.991209e+13 0.000000e+00\nstate29         55.500000000 7.598807e-14  7.303778e+14 0.000000e+00\nstate30        119.673913043 9.640040e-14  1.241425e+15 0.000000e+00\nstate32        -20.082608696",
        " 7.223309e-14 -2.780250e+14 0.000000e+00\nstate35         -5.813043478 7.269111e-14 -7.996911e+13 0.000000e+00\nstate36         13.073913043 7.377510e-14  1.772131e+14 0.000000e+00\nstate37         10.969565217 7.244757e-14  1.514138e+14 0.000000e+00\nstate39          1.647826087 7.238629e-14  2.276434e+13 0.000000e+00\nstate40         22.926086957 7.504034e-14  3.055168e+14 0.000000e+00\nstate41         15.778260870 7.265416e-14  2.171694e+14 0.000000e+00\nstate42         -7.530434783 7.390549e-14 -1.018928e+14 0.000000e+00",
        "\nstate43         10.473913043 7.355031e-14  1.424048e+14 0.000000e+00\nstate44         -0.008695652 7.242177e-14 -1.200696e+11 0.000000e+00\nstate45        -43.004347826 7.406394e-14 -5.806381e+14 0.000000e+00\nstate46         32.517391304 7.223997e-14  4.501302e+14 0.000000e+00\nstate47         26.600000000 7.236016e-14  3.676056e+14 0.000000e+00\nstate49          3.852173913 7.232336e-14  5.326320e+13 0.000000e+00\nstate50         -3.139130435 7.242696e-14 -4.334201e+13 0.000000e+00\nstate51         25.595652174",
        " 7.330584e-14  3.491625e+14 0.000000e+00\npost           -15.745369536 4.621576e+00 -3.406927e+00 6.569878e-04\nyear_dummyD_71   3.397297297 8.040145e-01  4.225418e+00 2.384979e-05\nyear_dummyD_72   7.970270270 1.425337e+00  5.591851e+00 2.246612e-08\nyear_dummyD_73   9.986486486 1.704304e+00  5.859568e+00 4.640718e-09\nyear_dummyD_74  13.378378378 1.926257e+00  6.945273e+00 3.777295e-12\nyear_dummyD_75  15.797297297 2.265707e+00  6.972347e+00 3.116972e-12\nyear_dummyD_76  20.067567568 2.444356e+00  8.209755e+00 2.216394e-16",
        "\nyear_dummyD_77  20.264864865 2.419744e+00  8.374799e+00 5.531841e-17\nyear_dummyD_78  20.010810811 2.309338e+00  8.665173e+00 4.508269e-18\nyear_dummyD_79  17.605405405 2.390385e+00  7.365091e+00 1.770255e-13\nyear_dummyD_80  17.832432432 2.561643e+00  6.961327e+00 3.370823e-12\nyear_dummyD_81  17.837837838 2.597438e+00  6.867475e+00 6.534836e-12\nyear_dummyD_82  16.110810811 2.800454e+00  5.752927e+00 8.771116e-09\nyear_dummyD_83  11.194594595 2.741755e+00  4.083004e+00 4.445727e-05\nyear_dummyD_84   4.913513514",
        " 2.980625e+00  1.648484e+00 9.925338e-02\nyear_dummyD_85   3.337837838 3.115147e+00  1.071486e+00 2.839508e-01\nyear_dummyD_86   0.783783784 3.262847e+00  2.402147e-01 8.101638e-01\nyear_dummyD_87  -2.327027027 3.195283e+00 -7.282695e-01 4.664487e-01\nyear_dummyD_88  10.429729730 1.739229e+00  5.996754e+00 2.013001e-09\nyear_dummyD_89   6.286486486 1.505018e+00  4.177018e+00 2.953554e-05\nyear_dummyD_90   2.248648649 1.251743e+00  1.796414e+00 7.242874e-02\nyear_dummyD_91   0.608108108 5.644959e-01  1.077259e+00 2.813647e-01",
        "\nca:post        -17.521327160 2.756275e+00 -6.356886e+00 2.058851e-10\n",
        "> ",
        "",
        "> ",
        "## 結果の抽出",
        "> ",
        "did_cluster_result <- Cigar_did_data_cluster[row.names(Cigar_did_data_cluster) == \"ca:post\",]",
        "> ",
        "did_cluster_result",
        "     Estimate    Std. Error       t value      Pr(>|t|) \n-1.752133e+01  2.756275e+00 -6.356886e+00  2.058851e-10 \n",
        "> ",
        "",
        "> ",
        "# (11) CausalImpactを利用した分析",
        "> ",
        "## ライブラリのインストール（初回のみ）",
        "> ",
        "install.packages(\"CausalImpact\")",
        "Error in install.packages : Updating loaded packages\n",
        "> ",
        "",
        "> ",
        "## CigarデータをCausalImpact用に整形",
        "> ",
        "### 目的変数としてカリフォルニア州の売上 だけ抜き出す",
        "> ",
        "Y <- Cigar %>% filter(state == 5) %>% pull(sales)",
        "> ",
        "",
        "> ",
        "### 共変量として他の州の売上を抜き出し整形",
        "> ",
        "X_sales <- Cigar %>%",
        "+ ",
        "  filter(state != 5) %>%",
        "+ ",
        "  select(state, sales, year) %>%",
        "+ ",
        "  spread(state,sales)",
        "> ",
        "",
        "> ",
        "### 介入が行われるデータを示す",
        "> ",
        "pre_period <- c(1:NROW(X_sales))[X_sales$year < 88]",
        "> ",
        "post_period <- c(1:NROW(X_sales))[X_sales$year >= 88]",
        "> ",
        "",
        "> ",
        "### 目的変数と共変量をバインドする",
        "> ",
        "CI_data <- cbind(Y,X_sales) %>% select(-year)",
        "> ",
        "",
        "> ",
        "## CausalImpactによる分析",
        "> ",
        "impact <- CausalImpact::CausalImpact(CI_data,",
        "+ ",
        "                                     pre.period = c(min(pre_period), max(pre_period)),",
        "+ ",
        "                                     post.period = c(min(post_period), max(post_period)))",
        "> ",
        "## 結果のplot",
        "> ",
        "plot(impact)",
        "\nRestarting R session...\n\n"
    ]
}